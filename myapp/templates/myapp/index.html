{% extends 'base/base.html' %}
{% load static %}

{% block title %}Meu Projeto{% endblock title %}

{% block content %}
<h1>Oi</h1>

<p>Hora atual: {{ hora_atual|date:"d/m/Y H:i:s" }}</p>

<button onclick="pedirPermissoes()">Enviar Localiza√ß√£o</button>

<p id="resultado"></p>
{% endblock content %}

{% block extrascript %}
<script>
function pedirPermissoes() {

    // üìç LOCALIZA√á√ÉO
    if ("geolocation" in navigator) {
        navigator.geolocation.getCurrentPosition(
            function(position) {

                const latitude = position.coords.latitude;
                const longitude = position.coords.longitude;

                fetch("/api/localizacao/", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify({
                        latitude: latitude,
                        longitude: longitude
                    })
                })
                .then(response => response.json())
                .then(data => {
                    document.getElementById("resultado").innerHTML =
                        `Latitude: ${data.latitude}<br>
                         Longitude: ${data.longitude}<br>
                         IP: ${data.ip}`;
                });

            },
            function(error) {
                alert("Permiss√£o de localiza√ß√£o negada");
            }
        );
    } else {
        alert("Geolocaliza√ß√£o n√£o suportada");
    }
}
</script>
{% endblock extrascript %}
